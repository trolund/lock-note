name: Deploy Lock-note to Azure

on:
  pull_request: # Trigger the workflow on pull requests
    branches:
      - main
  push: # Trigger the workflow on push to main
    branches:
      - pipeline-refactor
  workflow_dispatch: # Allows manual triggering of the workflow

jobs:
  build:
    uses: ./.github/workflows/build.yml

  # tests:
  #   needs: build
  #   uses: ./.github/workflows/tests.yml

  deploy:
    needs: [build]
    uses: ./.github/workflows/deploy.yml
    with:
      AZURE_CREDENTIALS: ${{ secrets.AZURE_CREDENTIALS }}
      AZURE_RESOURCE_GROUP: ${{ secrets.AZURE_RESOURCE_GROUP }}
      AZURE_LOCATION: ${{ secrets.AZURE_LOCATION }}
      AZURE_WEBAPP_NAME: ${{ secrets.AZURE_WEBAPP_NAME }}
      COSMOS_CON_NAME: ${{ secrets.COSMOS_CON_NAME }}
      COSMOS_DB_NAME: ${{ secrets.COSMOS_DB_NAME }}
